{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "width": 900,
    "height": 300,
    "title": "Average Weekly Attack Over Region",
    "data": {
      "url": "https://raw.githubusercontent.com/celineoww/FIT3179_A2/refs/heads/main/data/RegionAnalysis.csv"
    },
    "params": [
    {
      "name": "region_collection",
      "bind": {
        "input": "select",
        "options": [
          null,
          "APAC",
          "Africa",
          "Europe",
          "Latin America",
          "North America"
          
        ],
        "labels": [
          "Show All",
          "APAC",
          "Africa",
          "Europe",
          "Latin America",
          "North America"
        ],
        "name": "Region Collection: "
      }
    }
  ],
    "transform": [
      {
        "joinaggregate": [{"op": "count", "field": "Region", "as": "TotalRegions"}]
      },
      {
        "joinaggregate": [
          {"op": "count", "field": "Region", "as": "TotalRegionGrouped"}
        ],
        "groupby": ["Region"]
      },
      {
        "calculate": "round(datum.Percentage)",
        "as": "PercentOfTotal"
      },
      {
        "aggregate": [{"op": "min", "field": "PercentOfTotal", "as": "P"}],
        "groupby": ["Region"]
      },
      {"calculate": "sequence(1,datum.P+1)", "as": "S"},
      {"flatten": ["S"]},
      {
        "window": [{"op": "row_number", "as": "id"}],
        "sort": [{"field": "Region", "order": "descending"}]
      },
      {"calculate": "ceil (datum.id / 10)", "as": "row"},
      {"calculate": "datum.id - datum.row * 10", "as": "col"}
    ],
    "layer": [
      {
        "mark": {
          "type": "rect",
          "tooltip": true,
          "stroke": "black",
          "strokeWidth": 0.7
        },
        "encoding": {
          "x": {"field": "col", "type": "ordinal", "axis": null},
          "y": {"field": "row", "type": "ordinal", "axis": null, "sort": "-y"},
          "color": {
            "field": "Region",
            "type": "nominal",
            "scale": {
              "range": [
                "#1f77b4",
                "#ff7f0e",
                "#2ca02c",
                "#FF677D",
                "#9467bd"
              ]
            },
            "legend": {
              "title": "Region",
              "orient": "right",
              "labelFontSize": 12,
              "titleFontSize": 14
            }
          },
          "tooltip": [
            {"field": "Region", "type": "nominal", "title": "Region"},
            {"field": "P", "type": "quantitative", "title": "Percentage (%)"}
          ]
        }
      },
      
      {
        "mark": {
          "type": "text",
          "fontSize": 12,
          "fontWeight": "bold",
          "align": "left",
          "baseline": "middle",
          "dy": -5 
        },
        "transform": [
          {
            "filter": {
              "or": [
                {"field": "id", "equal": 1},
                {"field": "id", "equal": 21},
                {"field": "id", "equal": 31},
                {"field": "id", "equal": 81},
                {"field": "id", "equal": 51}
              ]
            }
          }
        ],
        "encoding": {
          "x": {"field": "col", "type": "ordinal", "axis": null, "scale": {"range": [800, 0]}}, 
          "y": {"field": "row", "type": "ordinal", "axis": null, "sort": "-y"},
          "text": {
            "field": "P","format": ".2f",
            "type": "nominal"
          }
        }
      }
    ],
    "config": {
      "view": {
        "stroke": null
      }
    }
  }
  